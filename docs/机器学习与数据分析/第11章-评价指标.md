这是机器学习旅程中至关重要的一章。

你可能会问：“泰坦尼克模型的准确率是 80%，广告模型的误差是 1.5。**这两个数字到底代表好还是坏？**”

如果不理解评估指标，你就无法判断模型是否可用，甚至可能被数字欺骗（比如 99% 的准确率可能是一个垃圾模型）。

本章我们将建立一套完整的**“裁判体系”**，根据任务的不同（回归 vs 分类），采用完全不同的评分标准。

---

# 第 11 章：裁判的艺术：模型评估与核心指标

## 11.1 回归模型的评估 (Regression Evaluation)

**场景回顾:** 你的广告销量模型预测某商品的销量是 20 万，但实际销量是 22 万。
回归任务的目标是预测一个**具体的数字**。我们的评估核心就是：**“预测值和真实值之间的差距（Error）有多大？”**

我们主要看三个指标：MAE, RMSE, 。

### 1. MAE (平均绝对误差) —— 最老实的指标

* **全称:** Mean Absolute Error
* **原理:** 把所有的误差绝对值加起来，求平均。
* **公式通俗版:** 
* **生动例子:**
* 预测房价。第一套房猜高了 5 万，第二套房猜低了 3 万。
* MAE =  万。
* **含义:** “平均来说，我的预测会偏离真实值 4 万块钱。”


* **优点:** 简单直观，单位和原始数据一样。

### 2. RMSE (均方根误差) —— 严厉的指标

* **全称:** Root Mean Squared Error
* **原理:** 先把误差**平方**（Square），求平均，最后**开根号**（Root）变回原来的单位。
* **为什么这么折腾？**
* 平方会**放大**大的误差。
* 误差是 2，平方后是 4。
* 误差是 10，平方后是 100。
* **RMSE 特别讨厌“大错误”**。如果你的模型在某一个样本上错得离谱，RMSE 会瞬间飙升。


* **地位:** 它是机器学习竞赛和工业界**最常用**的指标。

### 3.  Score (决定系数) —— 考试的百分制

* **痛点:** 如果我告诉你 RMSE 是 10，这算好吗？
* 如果预测房价（几百万），误差 10 块钱简直完美。
* 如果预测身高（一百多），误差 10 厘米就很垃圾。
* 光看误差值，很难跨业务比较。


* **原理:**  是一个 **0 到 1** 之间的分数（也可以理解为百分比）。
* **0 分:** 相当于瞎猜（直接用平均值当预测结果）。
* **1 分:** 完美预测，毫无误差。
* **负分:** 模型太烂了，甚至不如直接猜平均值。


* **含义:** 模型“解释”了数据波动的百分之多少。 意味着你的模型捕捉到了 80% 的规律。

---

## 11.2 分类模型的评估 (Classification Evaluation)

**场景回顾:** 泰坦尼克号生存预测。预测是生 (1) 还是死 (0)。
分类任务的评估比回归要复杂得多，因为这涉及到一个著名的**陷阱**。

### 🚨 准确率 (Accuracy) 的陷阱

**问题:** 假设我们要预测“是否患有罕见病”。每 100 人里只有 1 人患病。
我的模型是个**傻瓜模型**，它闭着眼睛对所有人说：**“没病！”**

* **预测结果:** 猜了 100 次，对了 99 次（99 个健康人猜对了），错了 1 次（那个病人漏掉了）。
* **准确率:** 。

**结论:** 准确率 99%，但这个模型是**垃圾**。因为它一个病人都没抓出来。

为了解决这个问题，我们需要引入 **混淆矩阵 (Confusion Matrix)**。

### 1. 混淆矩阵：真相的四个象限

我们把预测结果和真实结果画成一个  的表格：

|  | 真实是 1 (有病) | 真实是 0 (健康) |
| --- | --- | --- |
| **预测是 1 (有病)** | **TP (真阳性)** <br>

<br> 抓对了好人 | **FP (假阳性)** <br>

<br> 误诊 (虚惊一场) |
| **预测是 0 (健康)** | **FN (假阴性)** <br>

<br> 漏诊 (放虎归山) | **TN (真阴性)** <br>

<br> 猜对了没事 |

* **TP (True Positive):** 真的有病，我也说是。 (Success)
* **TN (True Negative):** 真的没病，我也说否。 (Success)
* **FP (False Positive):** 没病，我说是。 (误报 / Type I Error) —— *例如：没怀孕测出两道杠。*
* **FN (False Negative):** 有病，我说否。 (漏报 / Type II Error) —— *例如：癌症晚期告诉他是感冒。*

### 2. 精确率 (Precision) —— 查准率

* **问题:** **在我预测有病的人里，真的有病的比例是多少？**
* **场景:** 垃圾邮件拦截。
* 你不希望把重要的工作邮件误判为垃圾邮件（FP 代价很大）。
* 所以你要求 **精确率高**（宁可漏掉垃圾邮件，也不能错杀正常邮件）。


* **公式:** 

### 3. 召回率 (Recall) —— 查全率

* **问题:** **在所有真的有病的人里，我揪出来多少？**
* **场景:** 癌症筛查、地震预测。
* 你不希望漏掉任何一个病人（FN 代价极大，漏掉就是一条人命）。
* 哪怕误诊几个健康人（FP）也没关系，复查一下就行。
* 所以你要求 **召回率高**（宁可错杀一千，不可放过一个）。


* **公式:** 

### 4. F1-Score —— 平衡大师

* **痛点:** 精确率和召回率通常是**矛盾**的。你想抓得全（Recall高），就容易误报（Precision低）。
* **原理:** F1-Score 是精确率和召回率的**调和平均数**。
* **含义:** 只有当 Precision 和 Recall 都比较高时，F1 才会高。它是综合指标。

---

## 11.3 实战：用代码当裁判

理解了原理，在 Scikit-Learn 里调用这些指标非常简单。

### 1. 回归评估 (以广告销量为例)

```python
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score
import numpy as np

# 假设 y_test 是真实销量，y_pred 是模型预测销量
# y_test = [22, 10, ...]
# y_pred = [20, 11, ...]

# MAE
print("MAE:", mean_absolute_error(y_test, y_pred))

# RMSE (sklearn 没有直接的 rmse 函数，需要先算 mse 再开根号)
mse = mean_squared_error(y_test, y_pred)
rmse = np.sqrt(mse)
print("RMSE:", rmse)

# R2 Score
print("R2 Score:", r2_score(y_test, y_pred))

```

### 2. 分类评估 (以泰坦尼克号为例)

```python
from sklearn.metrics import confusion_matrix, classification_report, accuracy_score

# 假设 y_test 是真实生存情况，y_pred 是模型预测结果

# 1. 打印混淆矩阵
cm = confusion_matrix(y_test, y_pred)
print("混淆矩阵:\n", cm)

# 2. 打印“体检报告” (一次性把 Precision, Recall, F1 都打出来)
print("\n分类报告:\n", classification_report(y_test, y_pred))

```

**输出示例解读:**

```text
              precision    recall  f1-score   support
           0       0.82      0.88      0.85       105  (死)
           1       0.79      0.70      0.74        74  (生)

```

* **解读:** 对于活下来的人 (1)，模型的召回率 (Recall) 只有 0.70。说明**有 30% 真正活下来的人，被模型误判为死了。**

---

## 本章小结：指标选择指南

当你训练完模型，不知道该看哪个指标时，请查阅此表：

| 任务类型 | 业务场景 | 核心关注指标 | 理由 |
| --- | --- | --- | --- |
| **回归** | 房价/销量预测 | **RMSE** | 即使是 1 个大误差也不允许。 |
| **回归** | 业务汇报 | **** | 老板想看百分制（0-1），不想听具体误差值。 |
| **分类** | 垃圾邮件/推荐系统 | **Precision (精确率)** | 别把重要邮件当垃圾扔了（怕误报）。 |
| **分类** | 癌症筛查/抓逃犯 | **Recall (召回率)** | 宁可抓错，绝不漏掉（怕漏报）。 |
| **分类** | 样本不平衡 (罕见病) | **F1-Score / AUC** | 准确率 (Accuracy) 会骗人。 |

