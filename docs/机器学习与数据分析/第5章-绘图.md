# 第 5 章：透视数据真相：Matplotlib 与 Seaborn 深度实战

在数据科学界，**可视化 (Visualization)** 是我们与数据对话的语言。
如果只看枯燥的表格（DataFrame），你可能会错过很多关键信息：

* **趋势 (Trend):** 股票是涨是跌？
* **分布 (Distribution):** 用户年龄是集中在 20 岁还是 50 岁？
* **离群值 (Outliers):** 有没有数据是错误的，或者有异常行为？
* **关系 (Correlation):** 广告费投得越多，销量真的越高吗？

本章我们将结合 **Matplotlib (底层引擎)** 和 **Seaborn (高级装修)**，带你由浅入深掌握这项技能。

---

## 5.1 核心原理：为什么需要两个库？

很多初学者会困惑：*“既然 Seaborn 画图那么漂亮，为什么还要学 Matplotlib？”*

要回答这个问题，我们需要理解它们的关系：

### 1. Matplotlib：底层的“画师”

* **定位:** Python 绘图的**基石**。
* **原理:** 它模仿了 MATLAB 的绘图接口，提供了对图形最细粒度的控制。它能控制画布上的每一个像素、每一条线的粗细、每一个刻度的字体。
* **缺点:** 代码繁琐（画一个好看的统计图可能需要 20 行代码），默认配色比较“复古”（不够现代）。

### 2. Seaborn：高级的“装修队”

* **定位:** 基于 Matplotlib 封装的**统计绘图库**。
* **原理:** 它在 Matplotlib 之上穿了一层“漂亮的衣服”。它集成了 Pandas 的数据结构，内置了统计功能（比如自动计算置信区间、自动拟合回归线）。
* **优点:** 极简代码（1 行顶 Matplotlib 10 行），默认配色现代美观。

### ⚖️ 异同对比表

| 特性 | Matplotlib | Seaborn |
| --- | --- | --- |
| **层级** | 底层 (Low-level) | 高级 (High-level) |
| **数据支持** | 主要处理 NumPy 数组 | 完美支持 Pandas DataFrame |
| **灵活性** | ⭐⭐⭐⭐⭐ (无所不能) | ⭐⭐⭐ (固定模板) |
| **统计功能** | 无 (需要自己算好再画) | 强 (自动聚合、拟合) |
| **使用场景** | **调整细节** (改标题、轴标签、布局) | **快速分析** (看分布、看相关性) |

---

## 5.2 绘图的“万能公式” (General Workflow)

这是本章**最重要**的知识点。很多新手代码写得乱，是因为混用了两种写法。
在工业界，标准的**面向对象 (Object-Oriented)** 绘图套路如下：

### 第一步：搭台子 (Create Canvas)

使用 Matplotlib 创建**画布 (Figure)** 和 **子图/坐标系 (Axes)**。

```python
# fig 是整张画纸，ax 是画纸上具体的“一个格子”
fig, ax = plt.subplots(figsize=(8, 6))

```

### 第二步：画内容 (Plotting)

使用 Seaborn 将图画在指定的 `ax` 上。

```python
# 注意 ax=ax 参数，意思是“把图画在这个格子里”
sns.scatterplot(data=df, x='...', y='...', ax=ax)

```

### 第三步：修细节 (Customization)

使用 Matplotlib 的 `ax` 方法修改标题、标签等。

```python
ax.set_title("我的标题")
ax.set_xlabel("X轴名称")

```

### 第四步：展示 (Show/Save)

```python
plt.show()
# 或 plt.savefig('output.png')

```

---

## 5.3 准备工作

我们将使用 Seaborn 内置的经典数据集 **`tips` (餐厅小费数据)**。这是一个真实的数据集，包含了总账单、小费、性别、吸烟与否、星期几、时间（午/晚）等信息。

```python
import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

# 设置全局风格 (让图表变好看的秘诀)
sns.set_theme(style="whitegrid") # 风格: 白色网格背景
plt.rcParams['font.sans-serif'] = ['SimHei'] # 解决中文乱码 (Windows)
# plt.rcParams['font.sans-serif'] = ['Arial Unicode MS'] # Mac 用户用这个

# 加载数据
df = sns.load_dataset('tips')
print(df.head())

```

---

## 5.4 第一招：分布分析 (Univariate Analysis)

**问题:** 客人们通常消费多少钱？是集中在低消费，还是贫富差距很大？

### 🔧 核心工具：直方图 (Histogram) + 核密度 (KDE)

直方图通过“装箱子 (Binning)”的方式统计频率。

```python
# 1. 创建画布 (Figure) 和 子图 (Axes)
fig, ax = plt.subplots(figsize=(8, 5))

# 2. 绘制 Seaborn 图表
# data: 数据源, x: 我们要分析的列
# kde: 是否显示平滑曲线 (Kernel Density Estimate)
# bins: 箱子的数量 (切分得越细，细节越多)
sns.histplot(data=df, x='total_bill', kde=True, bins=20, color='teal', ax=ax)

# 3. 装修细节 (Matplotlib 发挥作用)
ax.set_title('顾客消费金额分布 (Check Normality)', fontsize=16)
ax.set_xlabel('总账单金额 ($)', fontsize=12)
ax.set_ylabel('人数 (频次)', fontsize=12)

# 4. 展示
plt.show()

```

**🧐 图表解读 (Data Insight):**

* **峰值:** 消费高峰在 10-20 美元之间。
* **偏态 (Skewness):** 这是一个典型的**右偏分布 (Right-skewed)**。尾巴向右延伸，说明有少量“土豪”消费了 40-50 美元。
* **决策:** 在机器学习中，面对这种数据，我们通常会对其做 `log` 变换，把它“压”回正态分布。

---

## 5.5 第二招：关系分析 (Bivariate Analysis)

**问题:** 消费越高，给的小费就越多吗？吸烟的人是不是更抠门？

### 🔧 核心工具：散点图 (Scatterplot) + 维度映射

这是寻找**特征相关性**最直观的方法。Seaborn 的强大在于它可以用颜色 (`hue`) 和形状 (`style`) 引入第 3、第 4 个维度。

```python
# 套用公式：1.搭台子
fig, ax = plt.subplots(figsize=(10, 6))

# 套用公式：2.画内容
# hue='smoker': 吸烟者用一种颜色，不吸烟用另一种
# size='size': 用点的大小代表用餐人数 (人数越多点越大)
sns.scatterplot(
    data=df, 
    x='total_bill', 
    y='tip', 
    hue='smoker', 
    size='size',
    sizes=(20, 200),
    alpha=0.8,
    ax=ax  # 关键：指定画在这个ax上
)

# 套用公式：3.修细节
ax.set_title('消费 vs 小费：多维度分析')

# 套用公式：4.展示
plt.show()

```

**🧐 图表解读:**

* **线性关系:** 整体看，点呈现从左下到右上的趋势，说明**正相关**（消费越高，小费越高）。
* **颜色分布:** 橙色点（吸烟者）和蓝色点（非吸烟者）似乎混合在一起，说明“是否吸烟”对小费影响不大。
* **离群点:** 如果发现有个点在右下角（消费很高但小费极低），那就是我们要抓的异常值。

---

## 5.6 第三招：类别对比 (Categorical Analysis)

**问题:** 周末大家会比平时更大方吗？

### 🔧 核心工具：箱线图 (Boxplot) & 小提琴图 (Violinplot)

箱线图是统计学的经典，但它丢失了分布细节；**小提琴图**则是箱线图的升级版，它展示了数据的“胖瘦”。

```python
# 高级技巧：一次画两张图 (1行2列)
fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# 左图：经典的箱线图 (画在 axes[0])
sns.boxplot(data=df, x='day', y='total_bill', palette='Set2', ax=axes[0])
axes[0].set_title('箱线图：看离群点')

# 右图：现代的小提琴图 (画在 axes[1])
# split=True: 如果有 hue，可以把小提琴劈成两半对比
sns.violinplot(data=df, x='day', y='total_bill', palette='Set2', ax=axes[1])
axes[1].set_title('小提琴图：看密度分布')

plt.show()

```

**🧐 图表解读:**

* **看箱线图 (左):**
* **黑线 (Median):** 中位数。
* **黑点 (Outliers):** 箱子上下须之外的点。我们可以看到周六 (Sat) 有几个极高的消费点，这些是异常值。


* **看小提琴图 (右):**
* 它展示了数据的“肚子”哪里最大。如果“肚子”很宽，说明大部分数据集中在这里。



---

## 5.7 终极奥义：多变量热力图 (Heatmap)

**问题:** 所有的数字特征中，哪两个关系最紧密？

这是特征工程中**最重要的图**，用于筛选特征。

```python
fig, ax = plt.subplots(figsize=(8, 6))

# 1. 计算相关系数矩阵 (-1 到 1)
# numeric_only=True: 只计算数字列
corr = df.corr(numeric_only=True)

# 2. 绘制热力图
sns.heatmap(
    corr, 
    annot=True,        # 在格子里显示数字
    cmap='coolwarm',   # 颜色：红=正相关，蓝=负相关
    fmt=".2f",         # 保留两位小数
    linewidths=0.5,    # 格子间距
    ax=ax
)

ax.set_title('特征相关性热力图')
plt.show()

```

**🧐 图表解读:**

* 看 `total_bill` 和 `tip` 的交叉点，系数是 **0.68**，颜色偏红。说明它们强相关。
* 如果看到某个特征和其他所有特征的相关性都是 0 (白色)，说明这个特征可能是无用的“噪音”，可以扔掉。

---

## 本章总结

通过本章，我们不仅学会了代码，更掌握了**“绘图思维”**：

1. **先搭台子:** 永远用 `fig, ax = plt.subplots()` 起手。
2. **选对工具:** * 看分布 -> **Histplot**
* 看趋势 -> **Scatterplot**
* 抓异常 -> **Boxplot**
* 选特征 -> **Heatmap**


3. **修整细节:** 用 `ax.set_title` 等方法让图表专业化。

**下一章预告：**
现在的你，既能清洗数据（Pandas），又能洞察数据（Seaborn）。
是时候让 AI 登场了！在 **第 6 章**，我们将使用 **Scikit-Learn**，把这些经过清洗和洞察的数据喂给算法，训练你的第一个**房价预测模型**。